<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Special Moments</title>
    <link rel="stylesheet" href="style1.css">
</head>
<body>
    <div class="container">
        <div class="gallery-content">
            <h1>Our Gallery</h1>
            <p>Welcome to our special moments.<br>(hover the mouse anywhere on the screen)</p>
        </div>

        <img src="image/musicbutton.gif" id="togglePlayerBtn" class="player-toggle-btn" title="Open Music Player" alt="Music Button">

        <div class="player-window" id="playerWindow">
            <div class="player-header">
                <h3>Music Player</h3>
                <button class="player-hide-btn" id="hidePlayerBtn" title="Hide Music Player">âˆ’</button>
            </div>
            <div class="cover-wrap">
                <img src="image/musiccover.jpg" alt="Cover" class="music-cover">
            </div>
            <div class="song-title" id="songTitle">Shirebound - Pahintulot</div>
            <audio id="audioPlayer" controls>
                <source src="image/Shirebound-Pahintulot.mp3" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
            <div style="text-align:center;">
                <button id="manualPlayBtn">Play</button>
            </div>
            <div class="duration" id="duration">0:00 / 0:00</div>
        </div>
    </div>

    <!-- cursor-spawned previews are created dynamically by JS -->

    <script>
        const audio = document.getElementById('audioPlayer');
        const durationDiv = document.getElementById('duration');
        const manualPlayBtn = document.getElementById('manualPlayBtn');
        const playerWindow = document.getElementById('playerWindow');
        const hidePlayerBtn = document.getElementById('hidePlayerBtn');
        const togglePlayerBtn = document.getElementById('togglePlayerBtn');
        let currentSongIndex = 0;

        // Hide player button
        hidePlayerBtn.addEventListener('click', function() {
            playerWindow.classList.add('hidden');
            togglePlayerBtn.classList.add('show');
        });

        // Toggle player button (show)
        togglePlayerBtn.addEventListener('click', function() {
            playerWindow.classList.remove('hidden');
            togglePlayerBtn.classList.remove('show');
        });

        audio.addEventListener('timeupdate', updateDuration);

        // Try to autoplay; if blocked by browser, show manual play button
        window.addEventListener('load', function() {
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.catch(function() {
                    manualPlayBtn.style.display = 'inline-block';
                });
            }
        });

        manualPlayBtn.addEventListener('click', function() {
            audio.play();
            manualPlayBtn.style.display = 'none';
        });

        function updateDuration() {
            const current = formatTime(audio.currentTime);
            const total = formatTime(audio.duration);
            durationDiv.textContent = `${current} / ${total}`;
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function previousSong() {
            // Placeholder for previous song functionality
            console.log('Previous song');
        }
        
        // --- Cursor-spawn gallery preview logic ---
        (function() {
            const galleryPath = 'image/imageGallery/';
            const totalImages = 31;
            const playerWindowEl = document.getElementById('playerWindow');
            let index = 1;
            let lastSpawn = 0;
            const spawnThrottle = 40; // ms between spawns (reduced for faster spawning)
            const displayTime = 1800; // ms visible before fade starts
            const fadeDuration = 1000; // ms fade duration (matches CSS)

            function spawnImageAt(x, y) {
                // don't spawn if pointer is over the music player
                if (playerWindowEl) {
                    const r = playerWindowEl.getBoundingClientRect();
                    if (x >= r.left && x <= r.right && y >= r.top && y <= r.bottom) return;
                }
                const now = Date.now();
                if (now - lastSpawn < spawnThrottle) return;
                lastSpawn = now;

                const img = document.createElement('img');
                img.src = galleryPath + index + '.png';
                img.className = 'cursor-image';
                img.style.left = x + 'px';
                img.style.top = y + 'px';
                // random tilt between -12 and +12 degrees
                const tilt = (Math.random() * 24) - 12;
                img.style.transform = `translate(-50%, -50%) rotate(${tilt}deg)`;
                document.body.appendChild(img);

                // prepare next index
                index = index >= totalImages ? 1 : index + 1;

                // start fading after displayTime
                setTimeout(() => {
                    img.classList.add('fading');
                }, displayTime);

                // remove element after fade completes
                setTimeout(() => {
                    if (img && img.parentNode) img.parentNode.removeChild(img);
                }, displayTime + fadeDuration + 50);
            }

            function onMouseMove(e) {
                spawnImageAt(e.clientX, e.clientY);
            }

            function onTouchMove(e) {
                const t = e.touches && e.touches[0];
                if (!t) return;
                spawnImageAt(t.clientX, t.clientY);
            }

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('touchmove', onTouchMove, { passive: true });
        })();
    </script>
</body>
</html>